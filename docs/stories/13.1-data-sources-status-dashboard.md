# Story 13.1: Data Sources Status Dashboard

**Epic:** Epic 13 - Dashboard Tab Completion  
**Priority:** High  
**Estimated Effort:** 2-3 days  
**Status:** Ready for Development

---

## Story Description

Create a comprehensive external data sources monitoring panel that shows real-time status, API usage statistics, and cache performance for all external integrations.

### User Story

**As a** system administrator  
**I want to** monitor all external API integrations in one place  
**So that** I can quickly identify issues with external services and optimize API usage

---

## Acceptance Criteria

### Functional Requirements

- [ ] **Display all external services** with status cards:
  - Weather API (OpenWeatherMap)
  - Carbon Intensity API
  - Air Quality API
  - Electricity Pricing API
  - Calendar Service
  - Smart Meter Service

- [ ] **Real-time status indicators** showing:
  - ðŸŸ¢ Healthy - Service responding normally
  - ðŸŸ¡ Degraded - Slow responses or intermittent failures
  - ðŸ”´ Error - Service unavailable or failing
  - âšª Unknown - No recent data

- [ ] **API usage statistics** for each service:
  - Total calls today
  - Calls remaining (for rate-limited APIs)
  - Percentage of daily quota used
  - Trend indicator (increasing/decreasing usage)

- [ ] **Performance metrics** displayed:
  - Average response time (ms)
  - Last successful call timestamp
  - Retry count (if applicable)
  - Error count (last 24 hours)

- [ ] **Cache performance** metrics:
  - Cache hit rate (%)
  - Cache size
  - Cached items count
  - Cache invalidation rate

- [ ] **Quick actions** available:
  - "Configure" button â†’ links to configuration tab
  - "Test Connection" button â†’ triggers test call
  - "View Logs" button â†’ shows service logs
  - "Clear Cache" button â†’ clears service cache

### Non-Functional Requirements

- [ ] **Performance:** Page loads in <1 second
- [ ] **Updates:** Status refreshes every 30 seconds automatically
- [ ] **Responsive:** Works on mobile (320px+) and desktop
- [ ] **Accessible:** Keyboard navigable, screen reader friendly
- [ ] **Dark Mode:** Full dark mode support
- [ ] **Error Handling:** Graceful degradation if API fails

---

## Technical Details

### Component Structure

```typescript
// src/components/DataSourcesPanel.tsx
interface DataSource {
  id: string;
  name: string;
  icon: string;
  status: 'healthy' | 'degraded' | 'error' | 'unknown';
  api_usage: {
    calls_today: number;
    quota_limit: number;
    quota_percentage: number;
  };
  performance: {
    avg_response_time_ms: number;
    last_success: string; // ISO timestamp
    retry_count: number;
    error_count_24h: number;
  };
  cache: {
    hit_rate_percentage: number;
    size_bytes: number;
    item_count: number;
  };
}
```

### API Endpoints

**GET /api/v1/data-sources/status**
```json
{
  "sources": [
    {
      "id": "weather-api",
      "name": "Weather API",
      "icon": "â˜ï¸",
      "status": "healthy",
      "api_usage": {
        "calls_today": 47,
        "quota_limit": 100,
        "quota_percentage": 47
      },
      "performance": {
        "avg_response_time_ms": 245,
        "last_success": "2025-10-12T14:23:15Z",
        "retry_count": 0,
        "error_count_24h": 0
      },
      "cache": {
        "hit_rate_percentage": 85,
        "size_bytes": 524288,
        "item_count": 42
      }
    }
  ],
  "last_updated": "2025-10-12T14:30:00Z"
}
```

**POST /api/v1/data-sources/{source_id}/test**
- Tests connection to specific data source
- Returns success/failure with details

**POST /api/v1/data-sources/{source_id}/cache/clear**
- Clears cache for specific data source
- Returns confirmation

### UI Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸŒ External Data Sources                                    â”‚
â”‚ Monitor external API integrations and performance           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚ â˜ï¸ Weather API     â”‚  â”‚ ðŸŒ± Carbon Intensityâ”‚            â”‚
â”‚ â”‚                    â”‚  â”‚                    â”‚            â”‚
â”‚ â”‚ ðŸŸ¢ Healthy         â”‚  â”‚ ðŸŸ¡ Degraded        â”‚            â”‚
â”‚ â”‚                    â”‚  â”‚                    â”‚            â”‚
â”‚ â”‚ API Usage Today    â”‚  â”‚ API Usage Today    â”‚            â”‚
â”‚ â”‚ 47/100 (47%)       â”‚  â”‚ 23/âˆž               â”‚            â”‚
â”‚ â”‚ â–¼ -5 from avg      â”‚  â”‚ â–² +8 from avg      â”‚            â”‚
â”‚ â”‚                    â”‚  â”‚                    â”‚            â”‚
â”‚ â”‚ Performance        â”‚  â”‚ Performance        â”‚            â”‚
â”‚ â”‚ â€¢ Resp: 245ms      â”‚  â”‚ â€¢ Resp: 2.5s âš ï¸    â”‚            â”‚
â”‚ â”‚ â€¢ Last: 2 min ago  â”‚  â”‚ â€¢ Last: 15 min ago â”‚            â”‚
â”‚ â”‚ â€¢ Errors: 0        â”‚  â”‚ â€¢ Retries: 2       â”‚            â”‚
â”‚ â”‚                    â”‚  â”‚                    â”‚            â”‚
â”‚ â”‚ Cache              â”‚  â”‚ Cache              â”‚            â”‚
â”‚ â”‚ â€¢ Hit rate: 85%    â”‚  â”‚ â€¢ Hit rate: 72%    â”‚            â”‚
â”‚ â”‚ â€¢ Size: 512 KB     â”‚  â”‚ â€¢ Size: 256 KB     â”‚            â”‚
â”‚ â”‚                    â”‚  â”‚                    â”‚            â”‚
â”‚ â”‚ [Configure] [Test] â”‚  â”‚ [Configure] [Test] â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                              â”‚
â”‚ [+ 4 more services...]                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Implementation Tasks

### Task 1: Backend API Endpoint (8 hours)
- [ ] Create `/api/v1/data-sources/status` endpoint in admin-api
- [ ] Implement status aggregation from existing services
- [ ] Add API usage tracking
- [ ] Add cache metrics collection
- [ ] Add test connection endpoint
- [ ] Add cache clear endpoint
- [ ] Write unit tests for endpoints
- [ ] Update API documentation

### Task 2: Frontend Component (8 hours)
- [ ] Create `DataSourcesPanel.tsx` component
- [ ] Create `DataSourceCard.tsx` sub-component
- [ ] Implement status polling hook
- [ ] Add status indicator logic
- [ ] Implement API usage display
- [ ] Implement performance metrics display
- [ ] Implement cache metrics display
- [ ] Add dark mode support

### Task 3: Actions & Interactions (4 hours)
- [ ] Implement "Test Connection" functionality
- [ ] Implement "Clear Cache" functionality
- [ ] Add confirmation dialogs
- [ ] Add loading states
- [ ] Add error handling
- [ ] Add success notifications

### Task 4: Polish & Testing (4 hours)
- [ ] Mobile responsive testing
- [ ] Dark mode testing
- [ ] Performance optimization
- [ ] Write E2E tests
- [ ] Accessibility testing
- [ ] Browser compatibility testing

---

## Testing Strategy

### Unit Tests
- Component rendering with various status states
- Status color logic
- API usage percentage calculations
- Cache hit rate display
- Action button handlers

### Integration Tests
- API endpoint responses
- Status polling mechanism
- Test connection functionality
- Cache clearing functionality

### E2E Tests
```typescript
test('displays all data sources with correct status', async () => {
  // Navigate to Data Sources tab
  // Verify all 6 services displayed
  // Verify status indicators correct
  // Verify metrics displayed
});

test('test connection functionality', async () => {
  // Click "Test Connection" on Weather API
  // Wait for test to complete
  // Verify success message
  // Verify status updates
});

test('clear cache functionality', async () => {
  // Click "Clear Cache"
  // Confirm dialog
  // Verify cache cleared
  // Verify metrics updated
});
```

---

## Dependencies

- Admin API (existing)
- Service monitoring infrastructure (existing)
- Dashboard layout (existing)

---

## Rollback Plan

If issues arise:
1. Revert to placeholder Data Sources tab
2. No database changes to rollback
3. Feature flag to disable new tab
4. Existing functionality unaffected

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Code reviewed and approved
- [ ] Unit tests written and passing (>80% coverage)
- [ ] Integration tests passing
- [ ] E2E tests written and passing
- [ ] Documentation updated
- [ ] Mobile responsive verified
- [ ] Dark mode verified
- [ ] Performance tested (<1s load time)
- [ ] Accessibility audit passed
- [ ] Product owner approval

---

**Created:** October 12, 2025  
**Story Owner:** Development Team  
**Reviewer:** UX Team, QA Team

