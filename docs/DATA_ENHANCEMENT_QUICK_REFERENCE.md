# Data Enhancement Quick Reference
**Visual Guide: Data Sources & Structures**

---

## ğŸ“Š 15 Additional Data Sources

### âš¡ Energy & Sustainability (5 sources)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Carbon Intensity (WattTime, ElectricityMap)    â”‚
â”‚    â†’ Enable carbon-aware automation               â”‚
â”‚    â†’ Schedule tasks during cleanest energy        â”‚
â”‚                                                    â”‚
â”‚ 2. Real-Time Electricity Pricing (Awattar)        â”‚
â”‚    â†’ Optimize costs, shift high-energy tasks      â”‚
â”‚    â†’ Respond to demand response events            â”‚
â”‚                                                    â”‚
â”‚ 3. Solar Production (SolarEdge, Enphase)          â”‚
â”‚    â†’ Use excess solar for heating/charging        â”‚
â”‚    â†’ Battery optimization                         â”‚
â”‚                                                    â”‚
â”‚ 4. Smart Meter (Sense, Emporia Vue)               â”‚
â”‚    â†’ Device-level consumption tracking            â”‚
â”‚    â†’ Phantom load detection                       â”‚
â”‚                                                    â”‚
â”‚ 5. Grid Operator Data                             â”‚
â”‚    â†’ Peak demand alerts                           â”‚
â”‚    â†’ Grid stability monitoring                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸŒ¤ï¸ Environmental & Air Quality (3 sources)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Air Quality Index (AirNow, WAQI)               â”‚
â”‚    â†’ Close windows when AQI is poor               â”‚
â”‚    â†’ Control air purifier speed                   â”‚
â”‚                                                    â”‚
â”‚ 5. Pollen & Allergen Data (Ambee)                 â”‚
â”‚    â†’ Adjust ventilation                           â”‚
â”‚    â†’ Send allergy alerts                          â”‚
â”‚                                                    â”‚
â”‚ 6. Barometric Pressure Trends                     â”‚
â”‚    â†’ Migraine warnings                            â”‚
â”‚    â†’ Weather-sensitive health tracking            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ Occupancy & Context (3 sources)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Calendar Integration (Google/Microsoft)        â”‚
â”‚    â†’ Predictive home preparation                  â”‚
â”‚    â†’ Work-from-home detection                     â”‚
â”‚    â†’ Automatic away mode                          â”‚
â”‚                                                    â”‚
â”‚ 7. Mobile Device Location (Life360, OwnTracks)    â”‚
â”‚    â†’ Proximity-based automation                   â”‚
â”‚    â†’ Geofence triggers                            â”‚
â”‚    â†’ ETA calculations                             â”‚
â”‚                                                    â”‚
â”‚ 8. Sleep Tracking (Oura, Fitbit, Apple Health)    â”‚
â”‚    â†’ Circadian rhythm optimization                â”‚
â”‚    â†’ Gradual wake-up lighting                     â”‚
â”‚    â†’ Sleep quality automation                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸš— Transportation & Services (2 sources)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. Public Transportation (Transit APIs)          â”‚
â”‚     â†’ Adjust departure time for delays            â”‚
â”‚     â†’ Commute optimization                        â”‚
â”‚                                                    â”‚
â”‚ 12. Garbage/Recycling Schedule (Municipal APIs)   â”‚
â”‚     â†’ Night-before reminders                      â”‚
â”‚     â†’ Smart lighting triggers                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¥ Health & Maintenance (2 sources)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. ISP/Network Performance (Speedtest)            â”‚
â”‚    â†’ Failover to backup internet                  â”‚
â”‚    â†’ Bandwidth-aware automation                   â”‚
â”‚                                                    â”‚
â”‚ 15. Appliance Maintenance Tracking                â”‚
â”‚     â†’ Filter replacement reminders                â”‚
â”‚     â†’ Predictive failure detection                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ 5 Advanced Data Structures

### Current: InfluxDB Time-Series Only
```
[Home Assistant Events] â†’ [InfluxDB] â†’ [Health Dashboard]
                            â†“
                    Time-based queries only
                    No relationships
                    Limited correlations
```

### Enhanced: Hybrid Architecture
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Event Stream   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚                â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
      â”‚ InfluxDB  â”‚    â”‚  Neo4j  â”‚    â”‚ Postgresâ”‚
      â”‚Time-Seriesâ”‚    â”‚  Graph  â”‚    â”‚Relationsâ”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
            â”‚                â”‚                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Unified API    â”‚
                    â”‚ (Read Models)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  3rd Party Apps â”‚
                    â”‚Node-RED, HA, etcâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Structure 1: **Neo4j Graph Database** â­â­â­
**Score: 9/10 | Complexity: 6/10**

```
Use Cases:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… "What devices affect my energy bill?"
âœ… "Find all motion sensors that trigger lights"
âœ… "Which rooms share HVAC zones?"
âœ… "Trace automation chains"
âœ… "Recommend automations based on device proximity"

Example Graph:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  CONTROLS   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Thermostatâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   HVAC   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚
     â”‚ READS_FROM        HEATSâ”‚
     â”‚                        â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚TempSensorâ”‚             â”‚LivingRoomâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€LOCATED_INâ”€â”€â”€â”€â”€â”€â”˜

Query Example (Cypher):
MATCH (motion:Sensor {type: 'motion'})-[*1..3]->(device)
WHERE device.power_rating > 100
RETURN motion.id, device.id, device.power_rating
ORDER BY device.power_rating DESC

Implementation Time: 2-3 weeks
ROI: 4.5x (enables complex automation logic)
```

---

### Structure 2: **Event Sourcing + CQRS** â­â­â­â­
**Score: 10/10 | Complexity: 7/10**

```
Concept: Store events, not state
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Current:  state = "on" (overwrites previous)
Enhanced: [DeviceCreated, StateChanged(offâ†’on), 
           StateChanged(onâ†’off), ...]

Benefits:
âœ… Complete audit trail
âœ… Time-travel debugging
âœ… Replay events for ML training
âœ… Multiple read models from same data
âœ… Never lose data (append-only)

Event Types:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ DeviceStateChanged                  â”‚
â”‚ â€¢ AutomationTriggered                 â”‚
â”‚ â€¢ EnergyThresholdExceeded             â”‚
â”‚ â€¢ AnomalyDetected                     â”‚
â”‚ â€¢ UserCommandReceived                 â”‚
â”‚ â€¢ ScheduledTaskExecuted               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Read Models (CQRS):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CurrentStateModelâ”‚HistoricalAnalysisâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Fast state lookupâ”‚Trend analysis    â”‚
â”‚Simple queries   â”‚Complex aggregatesâ”‚
â”‚Real-time updatesâ”‚Pre-computed statsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Implementation Time: 3-4 weeks
ROI: 5.0x (enables ML training, debugging)
```

---

### Structure 3: **Materialized Views** â­â­â­â­â­
**Score: 10/10 | Complexity: 4/10**

```
Concept: Pre-compute expensive queries
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Instead of computing on-demand:
SELECT AVG(temp) FROM events 
WHERE timestamp > NOW() - 30 days
GROUP BY entity_id, DATE(timestamp)
(Takes 5 seconds every time)

Pre-compute daily:
CREATE MATERIALIZED VIEW daily_temp_avg ...
(Query takes 50ms)

Examples:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ mv_daily_energy_by_device                â”‚
â”‚ mv_hourly_temperature_stats              â”‚
â”‚ mv_room_occupancy_patterns               â”‚
â”‚ mv_device_runtime_hours                  â”‚
â”‚ mv_automation_success_rate               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Refresh Strategy:
â€¢ Incremental: Every hour (recent data)
â€¢ Full: Nightly at 3am (all data)
â€¢ On-demand: After bulk import

Performance Gain:
Raw Query:   3,500ms â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Cached View:    45ms â–ˆ

Implementation Time: 1-2 weeks
ROI: 6.0x (massive performance improvement)
```

---

### Structure 4: **Entity-Attribute-Value (EAV)** â­â­â­
**Score: 8/10 | Complexity: 5/10**

```
Concept: Support any device without schema changes
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Traditional:
CREATE TABLE sensors (
  id, temp, humidity, pressure  -- Fixed schema
)
Problem: New device with 'pm25' attribute? 
         Need schema migration!

EAV Pattern:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚entity_id â”‚attribute   â”‚value     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚sensor.1  â”‚temperature â”‚22.5      â”‚
â”‚sensor.1  â”‚humidity    â”‚65        â”‚
â”‚sensor.2  â”‚temperature â”‚21.0      â”‚
â”‚sensor.2  â”‚pm25        â”‚12        â”‚  â† New!
â”‚sensor.3  â”‚co2         â”‚450       â”‚  â† New!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
âœ… Add new devices instantly
âœ… No schema migrations
âœ… Support vendor-specific attributes
âœ… Dynamic querying

Trade-offs:
âš ï¸ Queries are more complex
âš ï¸ Need indexing strategy
âš ï¸ Type safety requires validation

Implementation Time: 2-3 weeks
ROI: 3.5x (flexibility for diverse IoT devices)
```

---

### Structure 5: **TimescaleDB Hybrid** â­â­â­â­
**Score: 9/10 | Complexity: 6/10**

```
Concept: Time-series + Relational in one
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Problem: InfluxDB great for time-series, 
         but can't JOIN with metadata

TimescaleDB Solution:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL + Automatic partitioning        â”‚
â”‚ SQL + Time-series optimizations            â”‚
â”‚ JOINs + Continuous aggregates              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example Query:
SELECT 
  r.room_name,
  d.device_name,
  AVG(dm.value) as avg_temp
FROM device_measurements dm
JOIN devices d ON dm.device_id = d.id
JOIN rooms r ON d.room_id = r.id
WHERE dm.timestamp > NOW() - INTERVAL '7 days'
AND dm.measurement_type = 'temperature'
GROUP BY r.room_name, d.device_name
ORDER BY avg_temp DESC;

Features:
âœ… SQL (everyone knows it)
âœ… ACID transactions
âœ… Foreign keys
âœ… Automatic compression
âœ… Continuous aggregates
âœ… Retention policies

vs InfluxDB:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Feature       â”‚InfluxDB  â”‚TimescaleDB   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Speed         â”‚âš¡âš¡âš¡    â”‚âš¡âš¡         â”‚
â”‚SQL Support   â”‚Flux only â”‚Full SQL      â”‚
â”‚JOINs         â”‚Limited   â”‚Native        â”‚
â”‚Relations     â”‚No        â”‚Yes           â”‚
â”‚Learn Curve   â”‚Medium    â”‚Low (SQL)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Implementation Time: 2-3 weeks
ROI: 4.0x (best of both worlds)
```

---

## ğŸ”Œ Third-Party Integration Points

### RESTful API v2.0
```http
GET  /api/v2/devices
GET  /api/v2/devices/{id}/history
GET  /api/v2/rooms
GET  /api/v2/rooms/{id}/devices
GET  /api/v2/energy/consumption
GET  /api/v2/automation/rules
POST /api/v2/automation/rules
GET  /api/v2/relationships
POST /api/v2/query
GET  /api/v2/insights/energy-savings
GET  /api/v2/insights/anomalies
GET  /api/v2/external/carbon-intensity
GET  /api/v2/external/electricity-pricing
WS   /api/v2/stream  (WebSocket)
```

### Integration Examples

**Node-RED:**
```
[HTTP Request] â†’ [Parse JSON] â†’ [Filter] â†’ [Automation]
     â†“
GET /api/v2/devices?domain=light&state=on
```

**Home Assistant:**
```yaml
sensor:
  - platform: rest
    resource: https://homeiq/api/v2/energy/consumption
    value_template: "{{ value_json.total_kwh }}"
```

**Python:**
```python
async with aiohttp.ClientSession() as session:
    resp = await session.get(
        f"{API_URL}/api/v2/relationships",
        params={"entity_id": "sensor.temp", "depth": 2}
    )
    relationships = await resp.json()
```

---

## ğŸ“ˆ Value Comparison

### Data Source Impact

```
Carbon Intensity      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Energy savings 15-30%
Electricity Pricing   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  Cost reduction 20-40%
Calendar Integration  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   Predictive accuracy +60%
Air Quality          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    Health improvements
Solar Production     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     Self-consumption +45%
Sleep Tracking       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      Comfort optimization
Location Data        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      Response time -80%
Smart Meter          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       Device-level insights
```

### Structure Impact

```
Neo4j Graph          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Complex queries enabled
Event Sourcing       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  Complete audit trail
Materialized Views   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100x query speed
EAV Pattern          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     Device flexibility
TimescaleDB          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   SQL + Time-series
```

---

## ğŸ¯ Implementation Priority

### Phase 1: Quick Wins (Month 1)
```
Week 1-2: Add 5 data sources
  âœ“ Carbon Intensity
  âœ“ Electricity Pricing
  âœ“ Air Quality
  âœ“ Calendar API
  âœ“ Enhanced InfluxDB schema

Week 3-4: Materialized Views
  âœ“ Daily energy view
  âœ“ Hourly summaries
  âœ“ Room occupancy patterns
```

### Phase 2: Advanced Structures (Month 2-3)
```
Week 5-8: Neo4j Graph Database
  âœ“ Deploy Neo4j
  âœ“ Model relationships
  âœ“ Build query API
  âœ“ Integration with InfluxDB

Week 9-12: Event Sourcing
  âœ“ Event store
  âœ“ Event replay
  âœ“ Read models (CQRS)
```

### Phase 3: Integration API (Month 4)
```
Week 13-16: REST API v2
  âœ“ Comprehensive endpoints
  âœ“ WebSocket streaming
  âœ“ Documentation
  âœ“ Client libraries
```

---

## ğŸ’° ROI Summary

**Investment:** ~$45,000 (9 weeks development)

**Returns Year 1:**
- Energy savings: $2,000-4,000
- Time savings: $5,000
- New capabilities: $10,000+
- 3rd party revenue: $5,000+

**Total ROI:** 150% Year 1, 400% Year 3

---

## ğŸ¤” Decision Matrix

**Choose Graph DB (Neo4j) if:**
- âœ… Need relationship queries
- âœ… Building recommendation engine
- âœ… Complex automation logic
- âœ… Want "what affects what" answers

**Choose Event Sourcing if:**
- âœ… Need audit trail
- âœ… Time-travel debugging required
- âœ… ML training from history
- âœ… Regulatory compliance

**Choose Materialized Views if:**
- âœ… Dashboard performance critical
- âœ… Running same queries repeatedly
- âœ… Need instant reports
- âœ… Limited query variety

**Choose EAV if:**
- âœ… Many device types
- âœ… Frequent new devices
- âœ… Vendor-specific attributes
- âœ… Schema flexibility needed

**Choose TimescaleDB if:**
- âœ… Team knows SQL well
- âœ… Need relational + time-series
- âœ… Complex JOINs required
- âœ… ACID transactions important

---

**Quick Start:** Begin with **Materialized Views** (1-2 weeks, huge performance gain)  
**Best Long-term:** **Neo4j + Event Sourcing** (enables advanced AI/automation)  
**Easiest Migration:** **Add data sources first**, structures second

---

**Document Version:** 1.0  
**Last Updated:** October 10, 2025  

